This is the framework to allow callbacks from xmlBlaster to browsers.

If you don't have the JSDK (java servlet development kit from Sun)
installed, this will not compile.
Just ignore the warnings in this case.

The servlets connects to xmlBlaster using CORBA
and to the browser using a persistent http connection
(using a hidden frame to communicate).

The messages are directly transferred to the browser, which has a
XML parser and notifies the interested browser frames about the callback.
For Javascript examples see the javascript directory.


IMPORTANT NOTE FOR SERVLET INSTALLATION:
========================================
We need to run the JVM with the jacorb.jar file first in the bootclasspath
otherwise the JDK-internal CORBA is used.

If you install orb.properties into 'java.home' there will be no problem.

If you run jserv started automatically by Apache, jserv will
look for jacorb.properties and xmlBlaster.properties in the Apache
home directory.
If this is a problem, copy the two property files into 'java.home'
as well.
'java.home' is on my machine: /opt/jdk1.2.2/jre/lib/



Using Suns Web Development Kit (JSWDK):
=======================================
The servlet setup is easy if you use JSWDK.

The JavaServer Web Development Kit (JSWDK)1.0.1 combines the reference
implementation for JavaServer PagesTM 1.0.1 and the JavaTMServlet API (2.1).
   http://java.sun.com/products/jsp/download.html
and
   http://java.sun.com/products/servlet/

Configure it in webserver.xml:
   <Service id="service0" port="8082">
   ....

Start the server:
   startserver

Test it (netscape):
   http://localhost:8082/
   http://localhost:8082/examples/servlet/HelloWorldExample

(The servlets are in examples/WEB-INF/servlets)



Installing and configuring JServ for Apache:
============================================

As i used JServ and Apache to develop this framework here how
i installed and configured it.



http://www.apache.org The Servlet engine

rpm -iv ApacheJServ-1.1-2_RH6x.i386.rpm

Read
   /usr/doc/ApacheJServ-1.1/index.html

Read !!! the good Apache Jserv configuring overview at
   http://www.magiccookie.com/computers/apache-jserv/

1) Edit /etc/httpd/httpd.conf
      LoadModule jserv_module       /usr/lib/apache/mod_jserv.so
      AddModule mod_jserv.c
      <IfModule mod_jserv.c>
      Include /etc/httpd/conf/jserv/jserv.conf
      </IfModule>

2) Watch log output:
      tail -f  /var/log/httpd/jserv.log
      tail -f  /var/log/httpd/mod_jserv.log

3) As root
      /sbin/init.d/apache stop
      /sbin/init.d/apache start

4) Test it:
      http://localhost/servlets/IsItWorking
      http://localhost/jserv/

Config files setup:
===================

    httpd.conf -> jserv.conf -> jserv.properties -> zone.properties

5) Where are the xmlBlaster servlets lying around: 
   Edit /etc/httpd/conf/jserv/zone.properties

      # List of Repositories
      #######################
      repositories=/home/ruff/xmlBlaster/classes
      or:
      repositories=/home/ruff/xmlBlaster/lib/xmlBlaster.jar
      
      
      # Servlet Aliases
      ##################
      servlet.BlasterHttpProxyServlet.code=org.xmlBlaster.protocol.http.BlasterHttpProxyServlet
      servlet.BrowserTest.code=org.xmlBlaster.protocol.http.BrowserTest
      servlet.ReqListServlet.code=org.xmlBlaster.util.servlet.ReqListServlet
      servlet.ReqItemServlet.code=org.xmlBlaster.util.servlet.ReqItemServlet
      servlet.PXSLServlet.code=PXSLServlet

   Edit /etc/httpd/conf/jserv/jserv.properties

      wrapper.bin=/usr/local/jdk/bin/java

      wrapper.bin.parameters=-Dorg.omg.CORBA.ORBClass=jacorb.orb.ORB
      wrapper.bin.parameters=-Dorg.omg.CORBA.ORBSingletonClass=jacorb.orb.ORBSingleton

      security.authentication=false

6) We need to run the JVM with the jacorb.jar file first in the bootclasspath
   otherwise the JDK-internal CORBA is used.
   There are two variants with Apache/Jserv

   Start the serlvet runtime manually on your xterm (command prompt):

      - switch off the automatic starting in jserv.conf:
         ApJServManual on

      - # Apache JServ secret key file relative to Apache root directory.
        #ApJServSecretKey /etc/httpd/jserv/jserv.secret.key
        ApJServSecretKey DISABLED

      - use this script to start jserv (it is provided in the xmlBlaster/bin directory):
            #!/bin/sh
            properties=/etc/httpd/conf/jserv/jserv.properties
            log=${XMLBLASTER_HOME}/jserv_manual.log

            #The jsdk jar file is included already in .bashrc:
            #CLASSPATH=$CLASSPATH:/home/httpd/classes/servlet-2.0.jar

            CLASSPATH=$CLASSPATH:/usr/lib/apache/ApacheJServ.jar

            jaco -Djava.compiler= org.apache.jserv.JServ $properties $1
            #jaco org.apache.jserv.JServ $properties $1 2>> $log

7) Test it
   Start the Apache and then the servlet engine:

      jserv

   Invoke browser test servlet:

      http://localhost/servlets/BrowserTest?mode=push
      http://localhost/servlets/BrowserTest?mode=multi
      http://localhost/servlets/BrowserTest?mode=poll


   Watch log output (if there are problems):
 
      tail -f  /var/log/httpd/jserv.log

8) For an example see:

      xmlBlaster/demo/html/systemInfo       
