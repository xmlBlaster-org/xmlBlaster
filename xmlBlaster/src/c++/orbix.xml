<?xml version="1.0"?>

<!-- ===========================================================================

 xmlBlaster build file for ORBIX 2000 (V2.0) with CC sun compiler

 This file must be copied in xmlBlaster main directory in order to work properly. 
 Don't forget to modify the build.properties file...

Authors:
 Guy Donadio <guy.donadio@ses-astra.com>

=========================================================================== -->

<project default="cpp-lib" basedir=".">

  <taskdef resource="cpptasks.tasks"/> <!-- cc defineset compiler linker -->
  <typedef resource="cpptasks.types"/>

  <property name="compiler" value="CC"/>
  <property name="debug" value="true" />

   <!-- Allow any user specific values to override the defaults -->
   <property file="${user.home}/build.properties" />

   <!-- Set default values for the build -->
   <property file="build.properties" />

  <property name="build.dir"     value="./orbix_build"/>
  <property name="lib.dir"       value="./orbix_build"/>
  <property name="src.cpp.dir"   value="./src/c++" />
  <property name="testsuite.dir" value="./testsuite"/>
  <property name="lib.dir.absolute" location="./lib"/>  
  
  <!-- ORBIX setup --> 
  <property name="corba.dir"    value="./generated"/>      

  <!-- XML lib -->

  <property name="use-CC" value="1" />
  <compiler id="CC" name="CC" if="use-CC">
    <compilerarg value="-xtime"/>
  </compiler>   

  <target name="prepare-idl" depends="cpp-delete">      
      <echo message="Compiling idl..."/>
      <exec dir="${src.cpp.dir}/generated" executable="${CORBACPP_HOME}/${CORBACPP_VER}/bin/idl" failonerror="true">         
	<arg line="-base:-cS.cpp:-hS.h"/> 
	<arg line="-poa:-c.cpp:-h.h:-bS.h"/> 
	<arg line="/data/xmlBlaster/build/src/xmlBlaster/org/xmlBlaster/protocol/corba/xmlBlaster.idl"/>
      </exec>            
  </target>

  <target name="cpp-lib" depends="prepare-idl">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.dir}/obj"/>
    <cc debug="${debug}" link="shared"      
     outfile="${lib.dir}/xmlBlasterClient" objdir="${build.dir}/obj"
     multithreaded="true" exceptions="true" >   
       <compiler refid="CC"/>
       <compilerarg value="-Kpic"/>
       <compilerarg value="-Bdynamic"/>
       <fileset dir="${src.cpp.dir}/generated" includes="*.cpp"/>
       <fileset dir="${src.cpp.dir}/util" includes="*.cpp" />
       <fileset dir="${src.cpp.dir}/client" includes="*.cpp" />
       <sysincludepath location="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/include" />          
       <sysincludepath location="${XMLCPP_HOME}/src"/> 
       <sysincludepath location="${XMLCPP_HOME}/include/xercesc" />
       <sysincludepath location="${src.cpp.dir}" />
       <defineset>
         <define name="ORBIX" value="1" />
       </defineset>
       <linker name="CC" />
       <linkerarg value="-mt"/>
       <linkerarg value="-lpthread"/>
    </cc>
  </target>

  <target name="cpp-clean" description="Remove C++ object files">
    <delete dir="${build.dir}/obj"/>
    <delete includeEmptyDirs="true" failonerror="false">
      <fileset dir="${testsuite.dir}/src/c++" includes="*.o"/>
    </delete>
  </target>
 
  <target name="cpp-delete" depends="cpp-clean" description="Remove all generated C++ files/libs/executables">
    <delete includeEmptyDirs="true" failonerror="false">
      <fileset dir="${src.cpp.dir}/generated" includes="*.o, *.cpp, *.h"/>
      <fileset dir="${lib.dir}" includes="*xmlBlasterClient.so"/>
      <fileset dir="${testsuite.dir}/src/c++/bin" includes="*"/>
     </delete>
  </target>


   <target name="compileCppExe">
      <echo message="Compiling of C++ test client '${testsuite.dir}/src/c++/bin/TestGet' ..."/>
      <mkdir dir="${build.dir}/obj"/>
      <mkdir dir="${testsuite.dir}/src/c++/bin"/>
      <cc debug="true" link="executable"
          outfile="${testsuite.dir}/src/c++/bin/TestGet"
          objdir="${build.dir}/obj"
          multithreaded="true" exceptions="true">
         <compiler refid="CC"/>
         <fileset dir="${testsuite.dir}/src/c++" includes="TestGet.cpp"/>
         <includepath location="${src.cpp.dir}" />
         <sysincludepath location="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/include" />
         <sysincludepath location="${XMLCPP_HOME}/include/xercesc" />
         <sysincludepath location="${CORBACPP_HOME}/shlib"/>

         <linker name="CC"/>
         
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_art" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_dynany" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_event" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_event_psk" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_genie" />
	 <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_ifc" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_lease" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_load_balancing" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_location" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_message_routing" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_message_routing_psk" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_naming" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_naming_admin" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_notify" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_notify_psk" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_ots" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_ots_psk" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_poa" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_portable_interceptor" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_pss" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_pss_r" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_trader" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_trader_psk" />
         <libset dir="${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" libs="it_xa" />
         <libset dir="${XMLCPP_HOME}/lib" libs="xerces-c1_6_0" />
         <libset dir="${lib.dir}" libs="xmlBlasterClient" />

         <linkerarg value="-i"/>
         <linkerarg value="-lpthread"/>
         <linkerarg value="-L${CORBACPP_HOME}/${CORBACPP_VER}/cxx/lib" />
         <linkerarg value="-L${XMLCPP_HOME}/lib" />
         <linkerarg value="-L${lib.dir.absolute}" />
         <linkerarg value="-L${CORBACPP_HOME}/shlib/posix"/>
         <linkerarg value="-R ${CORBACPP_HOME}/shlib:${CORBACPP_HOME}/shlib/posix:/data/xmlBlaster/orbix_build:${XMLCPP_HOME}/lib"/>

         <syslibset dir="/lib" libs="dl"/>

         <defineset>
            <define name="ORBIX" value="1" />
         </defineset>
      </cc>
   </target>
</project>
