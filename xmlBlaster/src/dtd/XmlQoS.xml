<?xml version='1.0' encoding='ISO-8859-1' ?>

<!DOCTYPE xmlBlaster SYSTEM "XmlQoS.dtd">

<!-- Example of possible XML QoS (quality of services) -->
<!-- Note that the <demo> and <publish> etc. tags are NOT used when sending messages -->
<!-- you have to send only the <qos ...> tag and its descendant to the xmlBlaster -->

<demo>

   <!-- QoS when publishing without addressing (clients need to subscribe) -->
   <publish>
      <qos>
         <sender> <!-- Who published this message (the login name) -->
            jack
         </sender>
      </qos>
   </publish>


   <!-- QoS when publishing with direct addressing or broadcast -->
   <publish>
      <qos>
         <destination queryType='EXACT'>
            Tim
            <ForceQueuing />                 <!-- If the destination client is not logged in, queue the messages ->
         </destination>                      <!-- Default is no queuing and you get an exception if the client is not reachable -->

         <destination queryType='EXACT'>
            Ben
            <ForceQueuing timeout='12000' /> <!-- If the destination client is not logged in, queue the messages -->
         </destination>                      <!-- for a maximum of timeout seconds (timeout is not yet supported!) -->

         <destination queryType='XPATH'>
            //[GROUP='Manager']
         </destination>

         <destination queryType='XPATH'>
            //ROLE/[@id='Developer']
         </destination>

         <sender> <!-- Who published this message (the login name) -->
            joe
         </sender>
      </qos>
   </publish>


   <!-- QoS when publishing, supported flags (not yet :-) -->
   <publish>
      <qos>
         <sender> <!-- Who published this message (the login name) -->
            joe
         </sender>

         <expiration timeToLive='12000' />  <!-- Expires after given milliseconds (message is erased), clients will get a notify about expiration
                                            This value is calculated relative to the rcvTimestamp in the xmlBlaster server -->
                          <!-- Default is no expiration (similar to pass 0 milliseconds) -->
                          <!-- A second attribute timestamp='' may be added in a future version,
                               allowing to pass absolute UTC millis since 1970 instead of the relative timeToLive -->

         <isVolatile>false</isVolatile> 
                          <!-- A non-volatile messages stays in memory as long as the server runs or until it is erased explicitly -->
                          <!-- A volatile messages exists only during publish and processing it (doing the updates). -->
                          <!-- Default is false -->

         <isDurable />    <!-- The message shall be recoverable if xmlBlaster crashes -->
                          <!-- If you use this feature, you normally give the message a well known key oid -->
                          <!-- Default is transient -->

         <forceUpdate />  <!-- An update is forced even when the content and meta data didn't change -->
                          <!-- Default is that identical published messages aren't sent to clients again -->

         <readonly />     <!-- A final/const message which may not be changed with further updates -->
                          <!-- Default is Read/Write -->

         <defaultContent> <!-- Used content if the content given is null -->
            Empty
         </defaultContent>

         <check lang='TCL'> <!-- Allow content checking with a scripting language -->
            $content GE 100 <!-- Scripting inside xmlBlaster is not yet supported (JACL, Javascript) -->
         </check>

         <alter lang='TCL'> <!-- Allow content manipulation with a scripting language -->
            set content [$key('4711') * 1.2 + $content] <!-- Scripting inside xmlBlaster is not yet supported (JACL, Javascript) -->
         </alter>
      </qos>
   </publish>


   <!-- QoS when accessing messages -->
   <get>
      <qos>
         <noMeta />       <!-- Don't send me the key meta data on updates -->
         <noContent />    <!-- Don't send me the content data on updates (notify only) -->
      </qos>
   </get>


   <!-- QoS when subscribing to messages -->
   <subscribe>
      <qos>
         <noMeta />       <!-- Don't send me the xmlKey meta data on updates -->
         <noContent />    <!-- Don't send me the content data on updates (notify only) -->
         <noLocal />      <!-- Inhibit the delivery of messages to myself if i have published it -->
      </qos>
   </subscribe>


   <!-- QoS when unsubscribing from a message -->
   <unSubscribe>
      <qos>
      </qos>
   </unSubscribe>


   <!-- QoS when deleting messages -->
   <erase>
      <qos>
         <noNotify />     <!-- The subscribers shall not be notified when this message is destroyed -->
      </qos>
   </erase>


   <!-- QoS when updating messages and for return values of get() method -->
   <update>
      <qos>
         <state>          <!-- Server state -->
            EXPIRED       <!-- OK | EXPIRED | ERASED -->
         </state>
         <sender>         <!-- The publisher login name of this message -->
            Phillipe
         </sender>
         <subscriptionId> <!-- The same id which you got returned from your previous subscribe() call -->
            Subscription-00 0F 42 37 1A 20 1B 47 28 49 -192.168.10.212-null-952096108799-1
         </subscriptionId>
         <rcvTimestamp millis='1007764305862' nanos='123456789'> <!-- UTC time when message was created in xmlBlaster server with a publish() call, nanos currently not supported -->
            2001-12-07 23:31:45.862 <!-- The millis from above human readable -->
         </rcvTimestamp>
         <queue index='0' of='1'> <!-- If queued messages are flushed on login -->
         </queue>
      </qos>
   </update>


   <!-- QoS with login -->
   <client>
      <qos>
         <securityService type="simple" version="1.0">
           <![CDATA[
             <user>michele</user>
             <passwd>secret</passwd>
           ]]>
         </securityService>
         <session timeout='3600000' maxSessions='20'>
         </session>
         <!-- compress / burstMode / noPtP are allowed in all callback types -->
         <callback type='IOR'> <!-- Use CORBA to callback messages -->
            IOR:00011200070009990000....
            <compress type='gzip' minSize='1000' />
                      <!-- compress messages bigger 1000 bytes before sending them to me -->

            <burstMode collectTime='400' /> <!-- Collect messages for 400 milliseconds and update
                       them in one callback (burst mode)
                       This update mode is a 'transaction' for all collected messages -->
                       <!-- other attributes like numMsg or maxSize could allow other 'transaction' ranges -->
         </callback>
         <callback type='EMAIL'>
            et@mars.universe
            <PtP>false</PtP> <!-- Set this flag if you don't want to receive any PtP messages -->
                      <!-- prevents 'spamming' -->
         </callback>
         <callback type='XML-RPC'>
            http:/www.mars.universe:8080/RPC2
         </callback>


         <offlineQueuing timeout='3600' /> <!-- Messages older than timeout seconds
                            (the time the client is offline) are discarded -->

         <offlineQueuing maxMsg="36" /> <!-- Queue not more than 36 messages, older are discarded
                            off the end -->

         <offlineQueuing maxSize="2000" /> <!-- Max queue size in kByte, if exceeded, the
                             oldest are discarded -->
      </qos>
   </client>

</demo>


