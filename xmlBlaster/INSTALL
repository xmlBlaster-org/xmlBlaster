#################################################################
#                                                               #
#             xmlBlaster 0.77 Millenium Edition                 #
#           Free Message Oriented Middleware (MOM)              #
#                 http://www.xmlBlaster.org                     #
#                                                               #  
#################################################################

Welcome!

We hope these hints are useful to get you running with xmlBlaster.
If  you  have  problems, don't hesitate to contact the maintainers
through the mailing list (see http://www.xmlBlaster.org).

If  you  do  some own hacks, feel free to contribute them back, so
anybody  benefits  from  your  glorious invention. This project is
living  from  ideas and contributions. If you are a Python hacker,
why  not  contribute  some  Python  helper  classes? If you prefer
Smalltalk,  why  not contributing your xmlBlaster client solution?
But, if you are lazy, just use and enjoy xmlBlaster as delivered!


+--------------------+
| REQUIRED           |
+--------------------+

   - JDK 1.2 or later
   - A GNU 'make' utility recommended (if you want to rebuild xmlBlaster).
     For DOS/Windows, e.g. cygwin's make.
     Note that Windows nmake will not work properly with xmlBlaster Makefiles
   - or -
     You can use Ant.  See the build.xml file for more details.


+--------------------+
| INSTALLATION       |
+--------------------+

XmlBlaster comes compiled and ready to go.
Unpack the distribution to some location ($HOME/xmlBlaster is a good spot).

1. Extend your CLASSPATH and PATH environment variable. 

   a) If you use sh, ksh or bash, you may chose to source the
      $XMLBLASTER_HOME/.bashrc into your environment.

      export JDK_HOME=/usr/local/jdk
      export PATH=${JDK_HOME}/bin:$PATH
      export XMLBLASTER_HOME=${HOME}/xmlBlaster 
      export JUTILS_HOME=${XMLBLASTER_HOME}
      . ${XMLBLASTER_HOME}/.bashrc

    This is the recommended way, since you will automatically
    source all enhancements of new xmlBlaster releases.

    Now the installation is finished.
    After a new login you are ready to start xmlBlaster (see below).


   b) If you did not follow step a), here is how to setup
      your environment manually (examples for csh or tcsh):

     setenv JDK_HOME /usr/local/jdk
     setenv PATH ${JDK_HOME}/bin:$PATH

     setenv XMLBLASTER_HOME ${HOME}/xmlBlaster
     setenv JUTILS_HOME ${XMLBLASTER_HOME}

     setenv JacORB_HOME ${XMLBLASTER_HOME}
     setenv JacORB_LIB ${JacORB_HOME}/lib

     setenv CLASSPATH ${XMLBLASTER_HOME}/classes:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/src/java:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/demo:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/parser.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/jaxp.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/xtdash.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/omquery.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/servlet-2.0.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/test.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/xmlBlaster.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/jacorb.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/idl.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/gun-regexp-1.0.8.jar:${CLASSPATH}
     setenv CLASSPATH ${XMLBLASTER_HOME}/lib/xmlrpc.jar:${CLASSPATH}

    You can do this automatically from your startup shell script.
    After a new login you are ready to start the xmlBlaster (see below).


2. Copy xmlBlaster/orb.properties to JAVA_HOME/jre/lib (exactly 'java.home'/lib)
   or edit the existing orb.properties file.

   This switches off the default CORBA from JDK 1.2, and replaces it with
   the JacORB CORBA implementation.

   If you want to avoid this, you need to specify on command line:
      java -Dorg.omg.CORBA.ORBClass=jacorb.orb.ORB
           -Dorg.omg.CORBA.ORBSingletonClass=jacorb.orb.ORBSingleton


3. There are two property files which you can adjust.
   (They are copied automatically if you use the .bashrc from step 1a)

   a) $HOME/xmlBlaster.properties
      There is a template xmlBlaster/xmlBlaster.properties.template
      to use as a base.

   b) $HOME/jacorb.properties
      There is a template xmlBlaster/jacorb.properties.template
      to use as a base.

   Note: With 'java -Duser.home=yourHome ...' you could set another
         path to look for the property files.
         See requirement xmlBlaster/doc/requirements/util.property.xml
         for further search path.


4. Notes on adjusting your environment setup.
   You may wish to change the default environment setup for example
   if you have JacORB installed already, or to include your MICO C++ Corba library.
   You may do this with setting following variables before you source
   ${XMLBLASTER_HOME}/.bashrc (Note this is optional):

      export JacORB_HOME=/usr/local/JacORB   (to use your own JacORB installation)
      export MICO_HOME=/usr/local/mico       (to use C++ demo clients with mico)
      export JIKES_HOME=/usr/local/jikes     (to use your jikes java compiler instead of javac, http://www.alphaworks.ibm.com/tech/jikes)



+--------------------+
| RELATED LINKS      |
+--------------------+

   See ${XMLBLASTER_HOME}/lib/README
   See ${XMLBLASTER_HOME}/src/java/org/xmlBlaster/README



+-------------------------------------+
| START XMLBLASTER AS A CORBA SERVER  |
+-------------------------------------+

You have three options to start the xmlBlaster-Server.

See the ${XMLBLASTER_HOME}/src/java/org/xmlBlaster/README file for more
instructions.

One important note:
   You cannot start xmlBlaster on JDK 1.2.x with the java command directly,
   since this would use the JDK internal ORB (which is outdated).
   - Start xmlBlaster like this:
      java -Dorg.omg.CORBA.ORBClass=jacorb.orb.ORB
           -Dorg.omg.CORBA.ORBSingletonClass=jacorb.orb.ORBSingleton
   - Use our little script 'jaco' which does this
   - Or install orb.properties (see above, the recommended way)

1. A variant using the xmlBlaster built in http server (localhost / 7609 is default)
   (This is the Default-Startup)

     jaco org.xmlBlaster.MainGUI

   and a testclient
    
     jaco javaclients.ClientGet



2. A variant using the xmlBlaster built in http server, specify the port to listen

     jaco org.xmlBlaster.MainGUI -iorPort 7609

   and a testclient

     jaco javaclients.ClientGet -iorHost localhost -iorPort 7609



3. A variant using a file to pass the server IOR:

      jaco org.xmlBlaster.MainGUI -iorFile /tmp/Blaster_Ref

   and a testclient

     jaco javaclients.ClientGet -iorFile /tmp/Blaster_Ref



4. Variant using a naming service and a local web server to publish
   the name service IOR.

   Assuming the document root of your web server is /usr/local/httpd/htdocs/NS_Ref:

     ${JacORB_HOME}/bin/ns  /usr/local/httpd/htdocs/NS_Ref

   iorPort -1 switches the internal http server off:

     jaco org.xmlBlaster.MainGUI -iorPort 0

   This client looks into jacorb.properties to find the URL with the naming service IOR.
   Edit ${HOME}/jacorb.properties accordingly e.g. jacorb.NameServerURL=http://localhost:80/NS_Ref

     jaco javaclients.ClientXml -iorPort 0

   If you have problems, check your web server:

     telnet localhost 80
     GET /NS_Ref HTTP/1.0

   you should receive the IOR string, if everything is setup properly and the
   naming service is running.


+-----------------------------------+
| START XMLBLASTER AS A RMI SERVER  |
+-----------------------------------+

1. Add the driver to xmlBlaster.properties, this example starts
   the CORBA and the RMI server

   Protocol.Drivers=IOR:org.xmlBlaster.protocol.corba.CorbaDriver,RMI:org.xmlBlaster.protocol.rmi.RmiDriver
   Protocol.CallbackDrivers=IOR:org.xmlBlaster.protocol.corba.CallbackCorbaDriver,RMI:org.xmlBlaster.protocol.rmi.CallbackRmiDriver

2. Adjust the security policy file if you like to (it is currently totaly relaxed):

   xmlBlaster/config/xmlBlaster.policy

3. Start the server:

   java -Djava.security.policy=${XMLBLASTER_HOME}/config/xmlBlaster.policy  org.xmlBlaster.Main

4. And the demo client:

   java -Djava.security.policy=${XMLBLASTER_HOME}/config/xmlBlaster.policy  javaclients.rmi.ClientGet

Note:
   Another variant could be:

     java -Djava.rmi.server.codebase=file:///${XMLBLASTER_HOME}/classes/
          -Djava.security.policy=${XMLBLASTER_HOME}/config/xmlBlaster.policy
          -Djava.rmi.server.hostname=localhost
          org.xmlBlaster.Main

   Consult the SUN RMI documentation about 'codebase' and 'policy' settings.
   Especially 'codebase' should be used with a web server,
   to test if your code runs in a distributed environment.
     http://java.sun.com/products/jdk/1.2/docs/guide/rmi/faq.html
     http://archives.java.sun.com/archives/rmi-users.html


+--------------------+
| A DEMO CHAT CLIENT |
+--------------------+

Have a look at xmlBlaster/demo/javaclients/chat/SimpleChat.java
It´s a pretty basic kind of chat-application but worth a try.

Compile it (make all) and start it like that:

   jaco javaclients.chat.SimpleChat -name "Nickname"

where "Nickname" should be different for each client you start.
Don´t forget to start the server (jaco org.xmlBlaster.Main) first.



+--------------------+
| USING THE TESTSUITE|
+--------------------+

In the directory ${XMLBLASTER_HOME}/testsuite/org/xmlBlaster you will find
a number of Java based test clients to automatically test xmlBlaster.
   
The xmlBlaster test suite is based on the JUNIT 1.0 testsuite
from Kent Beck and Erich Gamma, see
   http://members.pingnet.ch/gamma/junit.htm

There is a GUI based and a command line based variant of the testsuite available.

To invoke the testsuite simply type:

   make test

Please read the
   ${XMLBLASTER_HOME}/testsuite/org/xmlBlaster/README
file for more informations.

You may also use the provided test clients to study the usage of xmlBlaster.


+--------------------+
| HOW TO COMPILE     |
+--------------------+

After you have set environment variables do a new login and type

   make all

in the XMLBLASTER_HOME directory. If you type make you get a usage 
of all make options.

Usage :

   make all       --> makes everything new
   make clean     --> deletes all classes
   make distclean --> deletes all classes/doc/jar
   make javadoc   --> call 'make javadoc' in xmlBlaster root dir
   make demo      --> makes everything new and starts a demo
   make test      --> makes everything new and starts a test scenario
   make jar       --> makes jar files of all packages into directory $(JAR_DIR)



#################################################################
#                                                               #
#                     xmlBlaster clients                        #
#                                                               #
#################################################################


                             C++ - client
-------------------------------------------------------------------------
C++ clients with MICO 2.3.0 (http://www.mico.org)

1) Install MICO
   ./configure --disable-mini-stl --prefix=/usr/local/mico
    make
    make install

2) Set the environment variable to point to MICO (needed for the Makefile)
   export MICO_HOME=/usr/local/mico
	export LD_LIBRARY_PATH=${MICO_HOME}/lib:$LD_LIBRARY_PATH

3) cd ${XMLBLASTER_HOME}/testsuite/c++
   and follow the instructions in ${XMLBLASTER_HOME}/testsuite/c++/README

                            Perl - client
-------------------------------------------------------------------------
Perl clients with COPE 0.50_51 (http://www.lunatech.com/research/corba/cope/)
You need MICO first

1) get Exception-0.97_01A.tgz (ftp://ftp.matematik.su.se/pub/teke.)

   perl Makefile.PL
   make
   make install    (su)

2) get COPE
   cvs -z3 -d :pserver:anonymous@cvs.lunatech.com:/home/cvscope/repo login
     <password just type enter>
   cvs -z3 -d :pserver:anonymous@cvs.lunatech.com:/home/cvscope/repo checkout

   perl Makefile.PL
   make
   make install    (su)

3) cd COPE/compat/MICO
   c++  -I. -I$MICO_HOME/include -I$MICO_HOME/include/ministl  -O   -fno-exceptions -fexceptions -O0 -I/usr/local/include  -c irior.cc -o irior.o
   c++  -I. -I$MICO_HOME/include -I$MICO_HOME/include/ministl  -O   -fno-exceptions -fexceptions -O0 -L$MICO_HOME/libs -L/usr/local/lib  -rdynamic irior.o -lmico2.3.0 -lreadline -lncurses -ldl -lm   -o irior

4) idl2perl -imp xmlBlaster.idl

5) cd ${XMLBLASTER_HOME}/testsuite/perl
   and follow the instructions in ${XMLBLASTER_HOME}/testsuite/perl/README

                         Tcl - Client
-----------------------------------------------------------------------
There are two ways for Tcl clients to access xmlBlaster:

a) Using Tcl clients with TclMico http://www.mico.org/
   tclmico-0.5c.tar.gz

    See directory ${XMLBLASTER_HOME}/testsuite/tcl
    for a demo client written in TCL and accessing the xmlBlaster server

b) Using tcljava (TclBlend/JACL) with an ordinary Java client
   This allows scripting of Java with Tcl, and embedding the
   Tcl interpreter (called jacl) into Java code.

 Here is a description how to use Tcl with MICO (a):
 First get a new Tcl release (e.g. 8.2) at http://www.scriptics.com
 or directly with cvs:
    export CVSROOT=:pserver:cvs@cvs.scriptics.com:/cvsroot
    cvs login   (passwd = cvs)

    cvs -z9 checkout tcl8.2
    cd tcl8.2/unix; autoconf; cd dltest ; autoconf ; cd ..
    ./configure --enable-shared --enable-threads --prefix=/www/tcl
    make
    make install
    cd /usr/bin; rm tclsh; ln -s /www/tcl/bin/tclsh8.2 tclsh

    cvs -z9 checkout tk8.2
    cd tk8.2/unix; autoconf;
    ./configure --enable-shared --prefix=/www/tk
    make
    make install
    cd /usr/X11R6/bin; rm wish; ln -s /www/tk/bin/wish8.2 wish
    cd /www/tcl/lib; ln -s /www/tk/lib/tk8.2 tk8.2

    tclmico-0.5c:
      export TCLMICO_HOME=/www/tclmico-0.5c
    cd ${TCLMICO_HOME}
    ./configure --enable-shared --with-tcl=/www/tcl
      make
      tclsh
         % load ./libtclmico[info sharedlibextension]
          % package require tclmico
          % corba::init -ORBIIOPAddr inet:localhost:4242

     cd /usr/local/lib
      ln -s libmico2.3.0.a libmico.a
      ln -s libmico2.3.0.so libmico.so

    cd ${TCLMICO_HOME}/demo/hello-1
    make all
      export PATH=$PATH:${TCLMICO_HOME}
      export LD_LIBRARY_PATH=${TCLMICO_HOME}:$LD_LIBRARY_PATH
      ./server -ORBIIOPAddr inet:localhost:8123
         ./client.tcl -ORBBindAddr inet:localhost:8123

Here a description to setup TclJava (b):
    cvs -z9 checkout tcljava
    cd tcljava/unix; autoconf;
    ./configure --with-jikes --with-jdk=/usr/local/jdk --with-tcl=/usr/local/tcl8.2 --prefix=/usr/local/tclJava


                           Python - Client
-------------------------------------------------------------------------
Python clients with Fnorb-1.01 http://www.dstc.edu.au/Products/Fnorb/
   fnorb-1.01.tar.gz
   cd src
   make -f Makefile.pre.in boot 
   FNORB_HOME=/Where/You/Put/Fnorb 
   export PATH=$PATH:$FNORB_HOME/Fnorb/script 
   export PYTHONPATH=$PYTHONPATH:$FNORB_HOME 

-------------------------------------------------------------------------


			orbacus for java and c++
-------------------------------------------------------------------------
xmlBlaster comes with jacorb. If you want to use another corba, some setting 
changes are necessary. XmlBlaster works also with orbacus for java
(JOB-4.0b3 or higher) and orbacus for c++ (OB-4.0b2 or higher). For more
information about orbacus see http://www.ooc.com.
to compile and run xmlBlaster with orbacus do the following:
   
   download orbacus for java and/or orbacus for c++ from http://www.ooc.com.
   compile & install it according to the packages instructions.
   cd ${XMLBLASTER_HOME}
   source ./.bashrc orbacus (this prepares all configuration to handle orbacus specific stuff
   make all

-------------------------------------------------------------------------



CORBA tuning with jacorb.properties:
------------------------------------
Increasing jacorb.outbuf_size=2048 to 16384 yields 1-5% performance gain

Changing jacorb.reference_caching=off to 'on' does help nothing, +-2%

Increasing jacorb.poa.thread_pool_max=20 to 1000                             
       and jacorb.poa.thread_pool_min=5  to 100  decreases performance 10-40%

Increasing jacorb.poa.queue_max=100 to 1000 does help nothing, +-2%
        but increases stability on heavy load (even higher values
		  decrease performance).

Changing jacorb.poa.thread_priority=MAX_PRIORITY (10) to 5 (NORM_PRIORITY)
        does help nothing, +-2%



Tuning with TowerJ native compiler:
-----------------------------------

This increases message throughput for approximatly 20-35%
It runs very stable.



Marcel - ruff@swand.lake.de
