<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='admin.telnet' type='NEW' prio='LOW' status="CLOSED">
   <topic>You can administer XmlBlaster using a telnet client</topic>
   <description>
    There is support to access xmlBlaster with telnet.
    You can for example query the free memory of the server JVM or shutdown xmlBlaster.
    <p>
    This is based on <a href="http://wttools.sourceforge.net/" target="others">Remote Console</a>
    of the WTTools project. 
    </p>
    <p>
    The plugin architecture of <i>remotecons</i> allowed us
    to add xmlBlaster specific functionality like internal state queries or setting
    of properties.
    </p>
    <p>
    The default port to access xmlBlaster is 2702, configuring the port to 0 switches
    telnet access off (see below).
    </p>

      <h3>
      How does the return value look like?
      </h3>
      <p>
         Responses of attributes have the key and the value, separated to lines.
         Messages are returned XML encoded.<br />
         The following table shows the return values of <i>get</i> invocations.
      </p>
      <table border="1">
         <tr>
            <td>Command</td>
            <td>Return</td>
            <td>Description</td>
         </tr>
         <tr>
            <td>get /node/?numNodes</td>
            <td><pre>
/node/?numNodes=5
            </pre></td>
            <td>The separator between the key and the value is '='
            </td>
         </tr>
         <tr>
            <td>get client/*/?uptime</td>
            <td><pre>
/node/client/joe/?uptime=345600
/node/client/jack/?uptime=19500
/node/client/averell/?uptime=19500
            </pre></td>
            <td>The query matched three users, the lines are seperated by cr and lf
            </td>
         </tr>
         <tr>
            <td>get /node/heron/?clientList</td>
            <td><pre>
/node/heron/?clientList=joe,jack,
   averell,william
            </pre></td>
            <td>The clientList is one attribute, containing the list of known clients
            </td>
         </tr>
         <tr>
            <td>get /node/heron/msg/?Hello</td>
            <td>
               <pre><![CDATA[
<xmlBlaster>
  <key oid='Hello' contentMime='text/plain'/>
  <content>How are you</content>
  <qos><rcvTimestamp nanos='1291'/></qos>
</xmlBlaster>
               ]]></pre>
            </td>
            <td>The query returns exactly one message
            </td>
         </tr>
      </table>

      <p>
         The next table shows the return values of <i>set</i> invocations:
      </p>
      <table border="1">
         <tr>
            <td>Command</td>
            <td>Return</td>
            <td>Description</td>
         </tr>
         <tr>
            <td>set client/joe/ses17/?cbQueueMaxMsgs=30000</td>
            <td>
               <pre><![CDATA[
<qos>
   <state id='OK' info='Blah'/>
</qos>
               ]]></pre>
            </td>
            <td>The returned string is XML encoded
            </td>
         </tr>
      </table>
      <br />
   </description>

   <example lang="any" type="HTML">
    Start xmlBlaster (port 2702 is default for telnet access).
    We configure the server to have a nice and short name <i>heron</i>:
    <pre>
  java org.xmlBlaster.Main -cluster.node.id heron
    </pre>

    and try a
    <pre>
  telnet myHost 2702
    </pre>

    Replace <code>myHost</code> with the IP where xmlBlaster runs.
    <p>
    Type <code>help</code> for a usage list.
    </p>

    <p>
    Now lets login to play:
    </p>
    <pre>
  CMD>connect admin secret

  Successful login for user admin, session timeout is  [ 10 min 0 millis ]
    </pre>

    <p>
    Example to query the home directory of the user which started xmlBlaster
    and the current free memory in the server, the last example queries how many
    users are currently known in the server:
    </p>
    <pre>
  CMD>get sysprop/?user.home

  /node/heron/sysprop/?user.home=/home/xmlblast


  CMD>get ?freeMem

  /node/heron/?freeMem=942272


  CMD>get /node/heron/?numClients

  /node/heron/?numClients=0
    </pre>

    <p>
    Here is an example change the logging level of the authentication modules:
    </p>
    <pre>
  CMD> set sysprop/?trace[auth]=true

  /node/heron/sysprop/?trace[auth]=true
    </pre>

    <p>
    This example sets a variable with replacement (currently not very useful):
    </p>
    <pre>
  CMD> set sysprop/?myTmpPath=${user.home}${file.separator}backup

  /node/heron/sysprop/?myTmpPath=/home/xmlblast/backup
    </pre>

    <p>
    Now lets query and change the run level:
    </p>
    <pre>
  CMD> get ?runlevel

  /node/heron/?runlevel=9

  CMD> set ?runlevel=3 

  /node/heron/?runlevel=3
    </pre>

    <p>
       Please read the <a href="admin.commands.html">admin.commands requirement</a>
       for a description of the command syntax.
    </p>

   </example>


   <example lang="any">
192.168.1.2 &lt;&lt; help
remotecons.wttools.ConnectionServer$InternalCommands >> 
  echo           - switch 'echo' mode (for windows telnet is really needed)
  quit           - close connection to server
  who            - list all active connections
  close n        - close active connection number 'n'
  help [command] - display this message info

org.xmlBlaster.engine.admin.extern.TelnetGateway >> 
  XmlBlaster telnet administration
   connect [name] [passwd]  Login with you login name and password
   get [query]              Get property or xmlBlaster state
   set [query]              Set a property or change xmlBlaster setting
   time                     Display current time on server
   gc                       Run System.gc() command on remote system
   mem [total|free]         Display amount of memory on remote system
   exit                     Call System.exit(0) on remote system
  For query syntax see
  http://www.xmlblaster.org/xmlBlaster/doc/requirements/admin.telnet.html
  http://www.xmlblaster.org/xmlBlaster/doc/requirements/admin.commands.html
   </example>

   <configuration where="server">
      <table border="1">
         <tr>
            <td>Property</td>
            <td>Default / Example</td>
            <td>Description</td>
            <td>Implemented</td>
         </tr>

         <tr>
            <td>admin.remoteconsole.port</td>
            <td>0</td>
            <td>Choose the port where xmlBlaster listens for telnet requests, 0 switches telnet access off.
                Port 2702 is a good port to try.<br />Example:
<pre>java org.xmlBlaster.Main
         -cluster.node.id heron
         -admin.remoteconsole.port 2702</pre>
                </td>
            <td>yes</td>
         </tr>

         <tr>
            <td>admin.remoteconsole.sessionTimeout</td>
            <td>3600000</td>
            <td>Auto logout after given milli seconds, defaults to one hour.</td>
            <td>yes</td>
         </tr>
      </table>
   </configuration>

   <todo type='HTML'>
      <p>
      Most is done, testsuite is missing.
      </p>
   </todo>
   
   <see type="INTERNET">http://wttools.sourceforge.net/remotecons/package.html</see>
   <see type="API">org.xmlBlaster.engine.admin.extern.TelnetGateway</see>
   <see type="REQ">admin</see>
   <see type="REQ">admin.commands</see>
   
   <author>ruff@swand.lake.de</author>
   
   <date>2002 05 09</date>
   
   <revision>$Revision: 1.13 $</revision>

   <testcase status="CLOSED">
      <name>-</name>
      <comment>Currently not necessary</comment>
      <test tool="SUITE"></test>
   </testcase>
</requirement>

