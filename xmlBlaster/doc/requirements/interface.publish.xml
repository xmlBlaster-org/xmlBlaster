<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='interface.publish' type='NEW' prio='HIGH' status="CLOSED">
   <topic>All messages sent to xmlBlaster use the publish method</topic>
   <description>
      <p>
      The <b>publish()</b> method allows to send messages to xmlBlaster or in point to point
      (PtP) mode route messages to other clients.
      </p>
      <p>
      Method detail (CORBA IDL notation):
      </p>
      <pre>
   string publish(in MessageUnit msgUnit) raises(XmlBlasterException);
      </pre>
         
      <table border="1">
         <tr>
         <th>Parameter</th><th>Type</th><th>Description</th>
         </tr>
         <tr>
         <td>msg</td><td>MessageUnit</td><td>A structure containing an XML key, an XML QoS and the binary message content (see MsgUnit link below)</td>
         </tr>
         <tr>
         <td>return</td><td>string</td><td>An XML based return string containing status and other informations (see PublishReturnQos link below)</td>
         </tr>
         <tr>
         <td>XmlBlasterException</td><td>exception</td><td>Thrown on error</td>
         </tr>
      </table>
      <p>
      Method variants:
      </p>
      <ul>
       <li>publishArr() Publishes many messages in a bulk</li>
       <li>publishOneway() Publishes many messages in a bulk without a return value (without synchronous ACK)</li>
      </ul>
   </description>


   <example lang="XML" type="HTML">
      <p>
      Here is an example MsgUnit:
      </p>
      <table border="1">
         <tr><td>Key</td><td>&lt;key oid='MyMessageOid' contentMime='text/plain'/></td></tr>
         <tr><td>Content</td><td>Hello world</td></tr>
         <tr><td>QoS</td><td>&lt;qos>&lt;priority>5&lt;/priority>&lt;/qos></td></tr>
      </table>
      <p>
      And a return value:
    </p>
   <table border="1"><tr><td>
   <pre>
&lt;qos>
   &lt;state id='OK' info='QUEUED[bilbo]'/>
   &lt;key oid='MyMessageOid'/>
&lt;/qos>
   </pre>
   </td></tr></table>
   </example>

   <example lang="XML" type="HTML">
      <p>
      Here is a full QoS:
      </p>
<pre>
  &lt;qos> &lt;
     &lt;state id='OK' info='Keep on running"/> <!-- Only for updates and PtP -->
     &lt;sender>Tim&lt;/sender>
     &lt;priority>5&lt;/priority>
     &lt;subscriptionId>subId:1&lt;/subscriptionId> <!-- Only for updates -->
     &lt;rcvTimestamp nanos='1007764305862000002'> &lt;!-- UTC time when message was created in xmlBlaster server with a publish() call, in nanoseconds since 1970 -->
           2001-12-07 23:31:45.862000002   &lt;!-- The nanos from above but human readable -->
     &lt;/rcvTimestamp>
     &lt;topic>&lt;expiration lifeTime='129595811'/>&lt;/topic> <!-- MsgUnitHandler lifecycle -->
     &lt;expiration lifeTime='129595811'/> <!-- Only for persistence layer -->
     &lt;isVolatile>false&lt;/isVolatile>
     &lt;queue index='0' of='1'/> &lt;!-- If queued messages are flushed on login -->
     &lt;isDurable/>
     &lt;readonly/>
     &lt;redeliver>4&lt;/redeliver>             <!-- Only for updates -->
     &lt;route>
        &lt;node id='heron'/>
     &lt;/route>
     &lt;topic readonly='false' destroyDelay='60000'>
        &lt;msgstore relating='topic' type='CACHE' version='1.0' maxMsg='1000' maxBytes='4000' onOverflow='deadMessage'/>
        &lt;queue relating='history' type='CACHE' version='1.0' maxMsg='1000' maxBytes='4000' onOverflow='exception'/>
     &lt;/topic>
  &lt;/qos>
</pre>
   </example>

   <example lang="XmlRpc" type="HTML">
      <p>
      This is the XmlRpc server interface variant:
      </p>
      <pre>
   public String publish (String sessionId, Vector msgUnitWrap) throws XmlBlasterException
      </pre>
   </example>

   <example lang="Java" type="HTML">
      <p>
      A typical Java client code in Publish/Subscribe mode:
      </p>
      <pre>
   import org.xmlBlaster.client.key.PublishKey;
   import org.xmlBlaster.client.qos.PublishQos;

   ...

   PublishKey pk = new PublishKey(glob, "HelloWorld4", "text/plain", "1.0");

   PublishQos pq = new PublishQos(glob);

   MsgUnit msgUnit = new MsgUnit(pk.toXml(), "Hi", pq.toXml());

   PublishReturnQos retQos = con.publish(msgUnit);
      </pre>

      <p>
      A typical Java client code in PtP mode:
      </p>
      <pre>
   import org.xmlBlaster.client.key.PublishKey;
   import org.xmlBlaster.client.qos.PublishQos;
   import org.xmlBlaster.util.SessionName;
   import org.xmlBlaster.engine.helper.Destination;

   ...

   PublishKey pk = new PublishKey(glob, "HelloWorld5", "text/plain", "1.0");

   PublishQos pq = new PublishQos(glob);
   pq.addDestination(new Destination(new SessionName(glob, "Tim/-5")));

   MsgUnit msgUnit = new MsgUnit(pk.toXml(), "Hi".getBytes(), pq.toXml());

   PublishReturnQos retQos = con.publish(msgUnit);
      </pre>

   <p>
   See xmlBlaster/demo/javaclients/HelloWorld*.java for more examples.
   </p>
   </example>

   <configuration>
   </configuration>

   <see type="API">org.xmlBlaster.util.MsgUnit</see>
   <see type="API">org.xmlBlaster.client.qos.PublishQos</see>
   <see type="API">org.xmlBlaster.client.qos.PublishReturnQos</see>
   <see type="API">org.xmlBlaster.client.protocol.XmlBlasterConnection</see>
   <see type="API">org.xmlBlaster.protocol.xmlrpc.XmlBlasterImpl</see>

   <see type="REQ">interface</see>

   <see type="REQ">engine.qos.publish.PubSub</see>
   <see type="REQ">engine.qos.publish.isDurable</see>
   <see type="REQ">engine.qos.publish.forceUpdate</see>
   <see type="REQ">engine.qos.publish.isVolatile</see>
   <see type="REQ">engine.qos.publish.readonly</see>

   <see type="REQ">engine.qos.publish.destination.PtP</see>
   <see type="REQ">engine.qos.publish.destination.ForceQueuing</see>
   <see type="REQ">engine.qos.publish.destination.PtX</see>
   <see type="REQ">engine.qos.publish.destination.offline</see>

   <see type="REQ">cluster.PtP</see>
 
   <author>xmlBlaster@marcelruff.info</author>
   <date>2002 06 01</date>
   <revision>$Revision: 1.11 $</revision>
   <testcase status="CLOSED">
      <name>-</name>
      <comment>Tests the publish method invocation</comment>
      <test tool="SUITE">org.xmlBlaster.test.qos.TestPub</test>
      <test tool="SUITE">org.xmlBlaster.test.qos.TestPtD</test>
      <test tool="SUITE">org.xmlBlaster.test.cluster.PublishTest</test>
      <test tool="SUITE">org.xmlBlaster.test.classtest.PublishQosTest</test>
      <test tool="SUITE">org.xmlBlaster.test.classtest.PublishReturnQosTest</test>
   </testcase>
</requirement>

