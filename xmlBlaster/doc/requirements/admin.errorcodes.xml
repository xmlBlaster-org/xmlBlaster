<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='admin.errorcodes' type='NEW' prio='LOW' status="INWORK">
   <topic>XmlBlaster supports well defined error codes</topic>
   <description>
    <p>
      XmlBlaster throws only one exception namely the XmlBlasterException.
      To distinguish the errors, xmlBlaster supports an hierarchical error code schema.
    </p>

    <p>
      The following drawing illustrates some exception situations:
    </p>
    <br />
     <img src="ExceptionHandling.gif" border="0" title="XmlBlaster exception handling example" alt="Example for xmlBlaster exceptions" />
    <br />

    <br />
    <p>
    We support a set of top level error code categories:
    </p>
    <table border="1">
     <tr><th>errorCode</th><th>Description</th></tr>
     <tr><td><b>internal</b></td>
       <td>
        Internal errors which are caused by programming errors like null-pointer, illegal arguments and other bugs.
        If such an error occurs you should report it to the xmlBlaster mailing list.
       </td>
     </tr>
     <tr><td><b>resource</b></td>
       <td>
        XmlBlaster uses many local resources like hard disk space, RAM and reading or writing files.
        If resources exhaust, or access to local resources is not possible or if the configuration
        of those resources is wrong this can usually be solved by the server administrator or deployer
        of xmlBlaster.<br />
        Some typical members of this category are outOfMemory, ioException, fileNotFound and more.
       </td>
     </tr>
     <tr><td><b>communication</b></td>
       <td>
        The communication layer to clients or other xmlBlaster cluster nodes is an important
        part of xmlBlaster. We could categorize them into the <i>resource</i> category as
        typical IO exceptions, but we keep them separate here to manifest the importance for the MoM.
       </td>
     </tr>
     <tr><td><b>user</b></td>
       <td>
         User errors are exceptions when clients access xmlBlaster in an illegal way.
         For example trying to login with a wrong password or sending a message with a corrupted
         XML-message key syntax will be reported by a <i>user</i> exception.
       </td></tr>
     <tr><td><b>transaction</b></td>
       <td>
         This is not specified yet.
       </td></tr>
     <tr><td><b>legacy</b></td>
       <td>
        Old style xmlBlaster exceptions are marked as <i>legacy</i> until they are ported to
        this new behaviour.
       </td>
     </tr>
    </table>
    <br />

    <p>
    Examples for the error codes <i>errorCode</i>:
    </p>
    <table border="1">
     <tr><th>errorCode</th><th>Description</th></tr>
     <tr><td>internal</td><td>Server internal problems</td></tr>
     <tr><td>internal.unknown</td><td>Server internal problems which are not known</td></tr>
     <tr><td>internal.nullpointer</td><td>Coding error (blame maintainers)</td></tr>
     <tr><td>internal.illegalArgument</td><td>Coding error</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>resource</td><td>Problems with resources on server hardware or configuration</td></tr>
     <tr><td>resource.outOfMemory</td><td>No more memory, increase RAM or <i>java -Xmx</i> option</td></tr>
     <tr><td>resource.noMoreSpace</td><td>No more space on harddisk</td></tr>
     <tr><td>resource.configuration.invalid</td><td>Your configuration (e.g. in xmlBlaster.properties) is invalid</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>communication</td><td>Problems with client server communication</td></tr>
     <tr><td>communication.noconnection.polling</td><td>We have currently no remote connection but are polling for it</td></tr>
     <tr><td>communication.noconnection.dead</td><td>The remote connection is dead and it is not possible to recover</td></tr>
     <tr><td>communication.address</td><td>The remote address is illegal, e.g. an invalid URL address</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>user</td><td>Errors caused by wrong usage</td></tr>
     <tr><td>user.security.authentication.accesDenied</td><td>Your login failed</td></tr>
     <tr><td>user.security.authorization.notAuthorized</td><td>Your message was not accepted</td></tr>
     <tr><td>user.publish.qos</td><td>Illegal syntax in your QoS</td></tr>
     <tr><td>user.publish.qos.destination</td><td>Message not delivered as destination is illegal</td></tr>
     <tr><td>user.publish.key</td><td>Your key has illegal syntax</td></tr>
     <tr><td>user.publish.key.oid</td><td>Such an oid is not accepted</td></tr>
     <tr><td>user.publish.maxSize</td><td>The message sent is too big</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>transaction</td><td>Todo</td></tr>
    </table>
    <br />

    <p>
    An XmlBlasterException contains a set of attributes describing an exception, all of type String:
    </p>
    <ol>
      <li><b>errorCode</b>:  The hierarchical error code (e.g. <i>"security.notauthenticated"</i>)</li>
      <li><b>node</b>:       Cluster node location (e.g. <i>/node/heron</i>)</li>
      <li><b>location</b>:   Logical location in the code (e.g. <i>client/joe/3-SubscriptionInfo</i>)</li>
      <li><b>lang</b>:       Choose language - lowercase two-letter ISO-639 code, choose country - uppercase two-letter ISO-3166 code (e.g. <i>"fr"</i> <i>"FR"</i> or <i>"fr_FR"</i> or <i>"de_DE"</i>)</li>
      <li><b>message</b>:     The human readable error text (e.g. <i>"Authorization denied for message oid 'accountRetrieval'"</i>)</li>
      <li><b>versionInfo</b>:     Information like xmlBlaster version, OS name, Java version etc.<br />
                  (e.g. <i>"version=0.81,os.name=Linux,java.version=1.4.1-rc, build.java.vendor=IBM,build.java.version=1.3.1, build.timestamp=06/17/2002 01:59 PM"</i>)</li>
      <li><b>timestamp</b>:       Timestamp when exception was thrown (e.g. <i>2002-02-10 11:57:51.804000001</i>)</li>
      <li><b>stackTrace</b>:      The stack trace (optional, for debugging)</li>
      <li><b>embeddedMessage</b>:    The original exception message (optional, if another exception is re-thrown)</li>
      <li><b>transactionInfo</b>: Transaction information</li>
    </ol>
    <br />
    <p>
    Examples for <i>location</i>:
    </p>
    <table border="1">
     <tr><th>location</th><th>Description</th></tr>
     <tr><td>/node/heron/client/joe/3</td><td>A specific user session</td></tr>
     <tr><td>/node/heron/protocol/email</td><td>Email protocol problems</td></tr>
     <tr><td>...</td><td>...</td></tr>
    </table>

    <br />
    <p>
    All ID's could be made available in a java.util.ResourceBundle,
    the client or server can display a localized text for the errorCode in this case.
    </p>

   </description>

   <example lang="XML" type="RAW">

An xml representation is

XmlBlasterException.toXml():
============================

 &lt;exception id='user.publish.qos'>

    &lt;errorCode>
       &lt;user>
          &lt;publish>
             &lt;qos/>
          &lt;/publish>
       &lt;/user>
    &lt;/errorCode>

    &lt;location>
       &lt;node>
           &lt;heron>
             &lt;client>
                &lt;joe/>
             &lt;/client>
           &lt;/heron>
       &lt;/node>
    &lt;/location>

    &lt;message>&lt;![CDATA[Invalid publish]]&gt;&lt;/message>

    &lt;stackTrace/>

 &lt;/exception>
   </example>

   <example lang="JAVA" type="RAW">

// Example showing how to convert an Exception (as a server developer)
import org.xmlBlaster.util.XmlBlasterException;
import org.xmlBlaster.util.enum.ErrorCode;

try {

   ... // Throws exceptions 

}
catch (CorbaException ex) {

   throw new XmlBlasterException(glob,
                  ErrorCode.COMMUNICATION_NOCONNECTION_POLLING,
                  this.getClass().getName(),
                  "No callback connection to client joe",
                  ex);

}
   </example>

   <example lang="JAVA" type="RAW">

// Example showing usage by a client

try {

   ... // Throws exceptions 

}
catch (XmlBlasterException ex) {

   if (ex.isInternal()) {
      // Displaying all information available:
      log4j.error(ex.toString());
   }
   else {
      // Displaying errorCode, message and embedded exception message if available:
      log4j.error(ex.getMessage());
   }

}
   </example>

   <todo type='HTML'>
   </todo>
   
   <see type="API">org.xmlBlaster.util.enum.ErrorCode</see>
   <see type="API">org.xmlBlaster.util.XmlBlasterException</see>
   <!-- see type="REQ">admin.commands</see -->
   
   <author>konrad.krafft@doubleslash.de</author>
   <author>ruff@swand.lake.de</author>
   <author>laghi@swissinfo.org</author>
   
   <date>2002 09 24</date>
   
   <revision>$Revision: 1.13 $</revision>

   <testcase status="OPEN">
      <name>-</name>
      <comment>Currently not available</comment>
      <test tool="SUITE"></test>
   </testcase>
</requirement>

