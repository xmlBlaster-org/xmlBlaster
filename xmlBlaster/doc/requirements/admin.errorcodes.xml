<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='admin.errorcodes' type='NEW' prio='LOW' status="OPEN">
   <topic>XmlBlaster supports well defined error codes</topic>
   <description>
    <p>
      XmlBlaster throws only one exception namely the XmlBlasterException.
      To distinguish the errors, xmlBlaster supports an hierarchical error code schema.
    </p>

    <p>
      The following drawing illustrates some exception situations:
    </p>
    <br />
     <img src="ExceptionHandling.gif" border="0" title="XmlBlaster exception handling example" alt="Example for xmlBlaster exceptions" />
    <br />

    <p>
    An XmlBlasterException contains a set of attributes describing an exception, all of type String:
    </p>
    <ol>
      <li><b>node</b>:       Cluster node location (e.g. /node/heron)</li>
      <li><b>errorCode</b>:  The hierarchical error code (e.g. "security.notauthenticated")</li>
      <li><b>location</b>:   Logical location in the code (e.g. client/joe/3-SubscriptionInfo)</li>
      <li><b>reason</b>:     The human readable error text (e.g. "Authorization denied for message oid 'accountRetrieval'")</li>
      <li><b>stackTrace</b>:      The stack trace (optional, for debugging)</li>
      <li><b>embeddedText</b>:    The original exception message (optional, if another exception is rethrown)</li>
      <li><b>transactionInfo</b>: Transaction information</li>
    </ol>
    <p>
    Examples for the error codes <i>errorCode</i>:
    </p>
    <table border="1">
     <tr><th>errorCode</th><th>Description</th></tr>
     <tr><td>internal</td><td>Server internal messages</td></tr>
     <tr><td>internal.nullpointer</td><td>Coding error (blame maintainers)</td></tr>
     <tr><td>internal.memoryexhaust</td><td>No more memory</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>invocation</td><td>The client method invocation is illegal or inappropriate</td></tr>
     <tr><td>invocation.publish.qos</td><td>...</td></tr>
     <tr><td>invocation.publish.qos.destination</td><td>...</td></tr>
     <tr><td>invocation.publish.key</td><td>...</td></tr>
     <tr><td>invocation.publish.key.oid</td><td>...</td></tr>
     <tr><td>invocation.publish.resourceexhaust</td><td>The message sent is too big</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>communication</td><td>Problems with client server communication</td></tr>
     <tr><td>communication.connectionlost</td><td>...</td></tr>
     <tr><td>communication.noconnection</td><td>...</td></tr>
     <tr><td>communication.address</td><td>e.g. Invalid URL address</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>security.notauthenticated</td><td>...</td></tr>
     <tr><td>security.notauthorized</td><td>Writing a readonly message, reading a message you are not allowed to</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>transaction</td><td>...</td></tr>
     <tr><td>...</td><td>...</td></tr>
     <tr><td>What else?</td><td>...</td></tr>
    </table>
    <p>
    Examples for <i>location</i>:
    </p>
    <table border="1">
     <tr><th>location</th><th>Description</th></tr>
     <tr><td>/node/heron/client/joe/3</td><td>A specific user session</td></tr>
     <tr><td>/node/heron/protocol/email</td><td>Email protocol problems</td></tr>
     <tr><td>...</td><td>...</td></tr>
    </table>

    <p>
    All ID's are available in a java.util.ResourceBundle
    the question is if the server already uses the localized
    text for the client language, or if the client uses the
    errorCode to find its localized error text. 
    </p>

   </description>

   <example lang="XML" type="RAW">
An xml representation is

XmlBlasterException.toXml():
============================

 &lt;exception id='invocation.publish'>

    &lt;errorCode>
       &lt;invocation>
          &lt;publish/>
       &lt;/invocation>
    &lt;/errorCode>

    &lt;location>
       &lt;node>
           &lt;heron>
             &lt;client>
                &lt;joe/>
             &lt;/client>
           &lt;/heron>
       &lt;/node>
    &lt;/location>

    &lt;reason>&lt;![CDATA[Invalid publish]]&gt;&lt;/reason>

    &lt;stackTrace/>

 &lt;/exception>
   </example>

   <example lang="any" type="RAW">
// Example showing how to convert an Exception (as a server developer)

try {

   ... // Throws exceptions 

}
catch (CorbaException ex) {

   throw new XmlBlasterException(glob,
                                 XmlBlasterException.COMMUNICATION+".connectionLost",
                                 this.getClass().getName(),
                                 "No callback connection to client joe",
                                 ex);

}
   </example>

   <example lang="any" type="RAW">
// Example showing usage by a client

try {

   ... // Throws exceptions 

}
catch (XmlBlasterException ex) {

   if (ex.isInternalError()) {
      // Displaying all information available:
      log4j.error(ex.toString());
   }
   else {
      // Displaying errorCode, reason and embedded exception message if available:
      log4j.error(ex.getMessage());
   }

}
   </example>

   <todo type='HTML'>
   </todo>
   
   <see type="REQ">admin.commands</see>
   
   <author>ruff@swand.lake.de</author>
   <author>laghi@swissinfo.org</author>
   
   <date>2002 09 24</date>
   
   <revision>$Revision: 1.5 $</revision>

   <testcase status="OPEN">
      <name>-</name>
      <comment>Currently not available</comment>
      <test tool="SUITE"></test>
   </testcase>
</requirement>

