<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='contrib.log.email' type='NEW' prio='LOW' status='OPEN'>
   <topic>A logging plugin which catches errors and dispatches them to a given email address.</topic>
   <description>
      <p>
      This is a configurable logging Plugin which has the characteristics of sending an email to a given 
      address when an error is logged. Logging happens asynchronously to avoid blocking. For this reason 
      messages to be sent are put into a queue and dispatched by a dedicated email callback plugin.
      </p>
      <p>
      This plugin wraps inside another logger. It listens to all log messages and if the log message is of
      the ERROR type, then it is sent by email. All messages are also written to the underlying logger, 
      the one defined by the 'logDevice' attribute of this plugin.
      </p>
      <p>
      A delay can be defined to let the dispatcher wait between sent messages, this way, in case of many
      errors, several errors can be dispatched in the same email, avoiding unnecessary noise. In other
      words, if an error occurs an email is sent immediately, but after this email until the next email
      is sent the dispatcher sleeps.
      </p>
      <p>
      You can set the maximum amount of entries to queue. If this amount is exceeded, then the message will
      not be sent, instead it will be written to the underlying (wrapped) log and a message will be sent
      telling that the queue has been overflowed.
      </p>
   </description>

   <example lang="XML" type="HTML">
      <pre>
      <![CDATA[
# this is the normal underlying log
LoggableDevicePlugin[console][1.0]=org.xmlBlaster.util.log.ConsoleLogDeviceFactory

# this is the wrapper which sends errors via email
LoggableDevicePlugin[emailOnError][1.0]=org.xmlBlaster.contrib.log.EmailOnErrorLogDeviceFactory,\
                                        logDevice=console,\
				        smtpHost=mail.provider.com,\
	 				from=joe@provider.com,\
					to=fritz@provider2.com,\
					subject=xmlBlaster error,\
 				        sleepDelay=60000,\
					maxQueueSize=100

# and here the device which will be used for logging
logDevice=emailOnError

      ]]>
      </pre>
   </example>

   <configuration where="server">
      <p>
      These parameters allow to configure the plugin.
      </p>
      <table border="1">
         <tr>
            <th>Property</th>
            <th>Default</th>
            <th>Description</th>
            <th>Implemented</th>
         </tr>

         <tr>
            <td>logDevice</td>
            <td>none</td>
            <td>This is mandatory. It specifies which logging to use</td>
            <td><img src="ok.gif" border="0" alt="yes" /></td>
         </tr>
         <tr>
            <td>smtpHost</td>
            <td>none</td>
            <td>This is mandatory. It specifies which smtp server to use</td>
            <td><img src="ok.gif" border="0" alt="yes" /></td>
         </tr>
         <tr>
            <td>from</td>
            <td>none</td>
            <td>This is mandatory. It specifies the 'from' email address</td>
            <td><img src="ok.gif" border="0" alt="yes" /></td>
         </tr>
         <tr>
            <td>to</td>
            <td>none</td>
            <td>This is mandatory. It specifies the destination email address</td>
            <td><img src="no.gif" border="0" alt="yes" /></td>
         </tr>
         <tr>
            <td>subject</td>
            <td>xmlBlaster error</td>
            <td>Specifies which subject to use when sending the emails</td>
            <td><img src="ok.gif" border="0" alt="yes" /></td>
         </tr>
         <tr>
            <td>sleepDelay</td>
            <td>0</td>
            <td>Time to sleep after every send in milliseconds. If 0 or negative then it will not wait.</td>
            <td><img src="no.gif" border="0" alt="no" /></td>
         </tr>
         <tr>
            <td>maxQueueSize</td>
            <td>100</td>
            <td>Specifies the amount of error messages to queue. Note that this does not necessarly coincide 
	        with the amount of emails sent since more than one messages could be sent in the same email.</td>
            <td><img src="no.gif" border="0" alt="no" /></td>
         </tr>
      </table>
   </configuration>

   <see type="API">org.xmlBlaster.util.plugin.I_Plugin</see>
   <see type="REQ">util.log.plugin</see>
   <author>laghi@swissinfo.org</author>
   <date>2005 04 23</date>			     
   <revision>$Revision: 1.1 $</revision>
   <testcase status="OPEN">
      <name>-</name>
      <comment>-</comment>
      <test tool="SUITE">org.xmlBlaster.test.contrib.log.TestEmailErrorLog</test>
   </testcase>
</requirement>

