<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='engine.runlevel' type='NEW' prio='MEDIUM' status="CLOSED">
   <topic>XmlBlaster supports different run levels</topic>
   <description>
     <p>
     An xmlBlaster server instance has different states, we call it <i>run levels</i> as a gesture of honor
     to the UNIX run levels.<br />
     The run level 0 is a stopped xmlBlaster, the run level 9 is a fully operational run level.
     </p>
     <p>
     Here is a description of the different run levels:
     </p>
      <table border="1">
         <tr>
            <th>Level</th>
            <th>No</th>
            <th>active Services</th>
            <th>Description</th>
         </tr>
         <tr>
            <td>HALTED</td>
            <td>0</td>
            <td>-</td>
            <td>XmlBlaster is not existing</td>
         </tr>
         <tr>
            <td>STANDBY</td>
            <td>3</td>
            <td>All configured plugins are alive
                but only administrative access from outside is possible</td>
            <td>XmlBlaster has sync'd all databases and just waits, it is ready to be killed or reactivated</td>
         </tr>
         <tr>
            <td>CLEANUP</td>
            <td>6</td>
            <td>All configured plugins are alive and operational
                but only administrative access from outside is possible</td>
            <td>XmlBlaster still flushes queues to other cluster nodes or to connected clients</td>
         </tr>
         <tr>
            <td>RUNNING</td>
            <td>9</td>
            <td>All configured plugins are alive</td>
            <td>XmlBlaster is fully operational</td>
         </tr>
     </table>

     <p>
     Administration features:
     </p>
     <ul>
       <li>Administer run level changes:<br />
       The internal command manager supports the attribute <i>getRunlevel()</i> and <i>setRunlevel()</i>
       allowing to monitor or change the run level via SNMP, telnet or other supported administration
       protocols (see requirement admin below).
       </li>
       <li>Every run level has a PRE and POST event fired:<br />
       The steps between the major run levels are pre and post events, they are not recorded as a stable
       run level but just as a transition.<br />
       For example the STANDBY run level has following pre/post events:
       <ul>
         <li>RUNLEVEL_STANDBY_PRE=2 This step fires a PRE-STANDBY event but is not a possible run level itself</li>
         <li>RUNLEVEL_STANDBY=3  This is a possible run level</li>
         <li>RUNLEVEL_STANDBY_POST=4 This step fires a POST-STANDBY event but is not a possible run level itself</li>
       </ul>
       The listeners can use these pre/post events to prepare the transition or do some logging or whatever
       they wish.
       </li>
     </ul>

     <p>
     Implementation features:
     </p>
     <ul>
       <li>How to implement run level changes:<br />
         The various plugin manager gets informed about run level changes if they
         have subscribed to run level events.<br /> The event contains
         the current run level and the destination run level, the manager
         decides autonomous what to do with this change, usually starting or
         stopping its plugins.
       </li>
       <li>Increments of run level changes:<br />
       The run levels are changed step by step, e.g. to change from level 9
       to level 3 six events are fired.
       </li>
     </ul>
   </description>


   <example lang="any" type="HTML">
   <p>
   You can play with the run levels interactive on command line, start the server
   and type '?' when it is up to get the usage:
   </p>
   <pre>
java org.xmlBlaster.Main
...

----------------------------------------------------------
Following interactive keyboard input is recognized:
Key:
   g             Popup the control panel GUI.
   r &lt;run level> Change to run level (0,3,6,9).
   d &lt;file name> Dump internal state of xmlBlaster to file.
   q             Quit xmlBlaster.
----------------------------------------------------------

r 3

[RunlevelManager] Change request from run level RUNNING to run level STANDBY ...
[RunlevelManager] Successful shutdown to run level=CLEANUP.
[CorbaDriver] POA and ORB are down, CORBA resources released.
[RunlevelManager] Successful shutdown to run level=STANDBY.
   </pre>
   </example>

   <configuration where="server">
      <table border="1">
         <tr>
            <th>Property</th>
            <th>Default</th>
            <th>Description</th>
            <th>Implemented</th>
         </tr>

         <tr>
            <td>runlevel</td>
            <td>9</td>
            <td>Choose run level on xmlBlaster server startup, e.g. <pre>java org.xmlBlaster.Main -runlevel 6</pre></td>
            <td>yes</td>
         </tr>
      </table>
   </configuration>

   <see type="API">org.xmlBlaster.engine.RunlevelManager</see>
   <see type="API">org.xmlBlaster.engine.I_RunlevelListener</see>
   <see type="REQ">admin</see>

   <author>ruff@swand.lake.de</author>
   <date>2002 06 14</date>
   <revision>$Revision: 1.5 $</revision>
   <testcase status="OPEN">
      <name>-</name>
      <comment>-</comment>
      <test tool="SUITE"></test>
   </testcase>
</requirement>

