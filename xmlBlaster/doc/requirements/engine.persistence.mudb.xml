<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='engine.persistence.mudb' type='NEW' prio='HIGH' status="INWORK">
   <topic>The XmlBlaster stores MessageUnits persistent in a MessageUnit database (MuDb). The persistence is controlled by a QoS-Flag.</topic>
   
   <description>
      <![CDATA[
      <p>
      -The 'persistence' section is the persistence of the xmlBlaster.
       I_PersistenceDriver is the interface for any persistence implementations.

      The MuDb MessageUnit-database a persistence for the xmlBlaster.
      MessageUnits are stored in a file-database if the QoS-Tag &lt;isDurable /&gt;
      is set. MessageUnits are cached in the memory and mapped on the 
      disk with COPY-BACK-Caching. The MuDb contains of a memory-cache
      ,file-database and a DOM which contanis the XmlKey. The settings
      for the MuDb can be done in the xmlBlaster.properties.<p>
      Caching:<br>
      The caching strategy used is "least recently used" (LRU). If the
      cache has reached the max. Cachesize, then the cache will be swapped
      each MessageUnit with LRU to the file-database.<p>
      Dom:<br>
      A DOM-Tree contains all XmlKey's for each MessageUnits in the cache
      and file-database.<p>

      Persistence:<br>
      If the Qos-Flag &lt;isDurable/&gt; is set, the MuDb writes the MessageUnit
      in a file with write-through-strategy. 
       ]]>     
   </description> 

   <example>
      <![CDATA[
        -----------------------------------------------
       |The settings in the xmlBlaster.properties-file |
        -----------------------------------------------
       mudb.Cachesize=3000000        # 3MByte Cachsize
       mudb.Dbpath=${user.home}/tmp
       mudb.Messagesize=5000         # 5KByte Messagesize


       Example: 

       MuDb mudb = new MuDb();        // Get a mudb-instance
       mudb.setMaxCacheSize(2000000L);  // The max. cachesize in Byte
 
       PublishQosWrapper qos = new PublishQosWrapper(true); // = <qos><isDurable /></qos>

       // Construct a MessageUnit which is persistent.
       String xmlKey = "<key oid='sender'>\n" +
                          "<person pid='10' gid='200'>" +
                             "<name age='31' sex='f'>Lisa</name>"+
                          "</person>" +
                       "</key>";
       String content = "Lisa's content";

       MessageUnit       mu = new MessageUnit(xmlKey, contentgetBytes(), qos);
 
       mudb.insert(mu);   // Insert the MessageUnit to MuDb.
       mudb.get(oid);     // Get the MessageUnit by oid.

       Enummeration muIter mudb.query("//key[@oid="100"); // Query by XPATH

       mudb.delete(oid);     // Delete MessageUnit from db by oid.
 
       mudb.showCacheState() // Shows you the current state of the cache.
 

   ]]>
   </example>
   <author>manuel.kron@gmx.net</author>
   <date>2000 07 16</date>
   <revision>$Revision: 1.1 $</revision>
</requirement>
