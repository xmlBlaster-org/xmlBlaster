<?xml version='1.0' encoding='ISO-8859-1' ?>
<!DOCTYPE requirement SYSTEM "requirement.dtd">

<requirement id='engine.qos.subscribe.id' type='NEW' prio='LOW' status="CLOSED">
   <topic>
      On subscribe you can force your own subscription id.
   </topic>
   <description>
     <p>
     Every subscription returns a unique handle namely the subscription ID.
     This is used to refer to exact this subscription on updated messages or
     un unsubscribe requests.
     </p>
     <p>
     This subscription ID is uniquely generated by xmlBlaster. On demand
     you can force xmlBlaster to use a subscription ID which is given by
     the subscriber. This subscription ID should be unique in the whole cluster
     environment, a proposed syntax is:
     </p>
     <pre>
"__subId:client/[loginName]/session/[publicSessionId]-[your number or id]"
     </pre>
     <p>
     Example:
     </p>
     <pre>
&lt;qos> <!-- subscribe QoS -->
   &lt;id>__subId:client/subscriber/session/2-13340998000&lt;/id>
   ...
&lt;/qos>
     </pre>
     <p>
     For java clients there is a prefix constant in org.xmlBlaster.util.def.Constants.java
     which you can use to build a unique subscription ID:
     </p>
     <pre>
   public final static String SUBSCRIPTIONID_PREFIX = "__subId:";
     </pre>
   <p>
   If you have a fail safe client configured, using a positive session id (e.g. 'client/joe/session/1')
   and the subscription flag multiSubscribe is set to false, the java and C++ client library
   will automaticaly generate a subscriptionId which won't change on next restart of the client
   and which will be used by the server. The syntax is like:
   </p>
   <pre>
__subId:[relativeSessionName]-[subscriptionUrl]
__subId:client/subscriber/session/2-exact:Hello
</pre>
   <p>
Benefit: If on client restart we are queueing the returned faked subscriptionId will
match the later used one of the xmlBlaster server. We can easily use the subscriptionId
as a key in a client code hashtable to dispatch update() messages.
</p>
<p>
Note: multiSubscribe==false allows max one subscription on a topic, even it has
different mime query plugins (the latest wins).
</p>

   </description>
   <example lang="Java" type="HTML">
<pre>
      <![CDATA[
import org.xmlBlaster.client.qos.SubscribeQos;

...

try {
   SubscribeQos sq = new SubscribeQos(glob);

   String subId = Constants.SUBSCRIPTIONID_PREFIX +
                  sessionName.getRelativeName(true) + "-" + myCounter;

   sq.setSubscriptionId(subId);

   String subId = con.subscribe("<key oid='NOTAM'/>, sq.toXml());
}
catch (Exception e) {
   ...
}
...
      ]]>
</pre>
   </example>
   <see>org.xmlBlaster.client.qos.SubscribeQos</see>
   <author>xmlBlaster@marcelruff.info</author>
   <hacker>xmlBlaster@marcelruff.info</hacker>
   <date>2002 06 26</date>
   <revision>$Revision: 1.7 $</revision>
   <testcase status="CLOSED">
      <name>-</name>
      <comment>-</comment>
      <test tool="SUITE">org.xmlBlaster.test.qos.TestSubId</test>
   </testcase>
</requirement>

